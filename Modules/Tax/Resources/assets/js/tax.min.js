'use strict';$(".conditional").ifs(),$("#v-pills-general-tab").trigger("click"),$(document).on("change","input, select",function(){changeSetting(this)}),$(document).on("click",".tab-name",function(){var a=$(this).attr("data-id");$("#theme-title").html(a),$(".tab-pane[aria-labelledby=\"home-tab\"").addClass("show active"),$("#"+$(this).attr("id")).addClass("active").attr("aria-selected",!0)});function changeSetting(a){$(a).closest(".parent").find(".warning-message").addClass("alert-secondary"),$(a).closest(".parent").find(".warningMessage").slideDown(300),$(a).closest(".parent").find("#warning-msg").html(jsLang("Settings have changed, you should save them!"))}function successNotification(a,b){a.find(".abc").addClass("alert-success"),a.find(".warningMessage").slideDown(),a.find(".msg").html(b)}function failNotification(a,b){a.find(".abc").addClass("alert-danger"),a.find(".warningMessage").slideDown(),a.find(".msg").html(b)}function errorNotification(a,b){a.find(".abc").addClass("alert-danger"),a.find(".warningMessage").slideDown(),$.each(b.responseJSON.errors,function(b,c){a.find(".msg").html(c)})}function timeoutNotification(a){setTimeout(()=>{a.closest(".parent").find(".warningMessage").slideUp(500),setTimeout(()=>{a.closest(".parent").find(".abc").removeClass("alert-success alert-danger")},501)},5e3)}$(document).on("click",".cr",function(){var a=$(this).closest(".switch").find("input").val();1==a?$(this).closest(".switch").find("input").val(0):$(this).closest(".switch").find("input").val(1)});const unblockEverything=()=>{$(".blockUI").each(function(){$(this).parent().unblock()})},blockElement=(a,b={})=>{let c=Object.assign({},{message:`<div class="spinner-border tax-rate-loader text-warning" role="status"><span class="sr-only">Loading...</span></div>`,css:{backgroundColor:"transparent",border:"none"}},b);a.block(c)},triggerNotification=a=>{$(".notification-msg-bar").find(".notification-msg").html(a),$(".notification-msg-bar").removeClass("smoothly-hide"),setTimeout(()=>{$(".notification-msg-bar").addClass("smoothly-hide"),$(".notification-msg-bar").find(".notification-msg").html("")},3e3)};$(document).on("click",".add-btn",function(){var a=$(this).attr("data-id");$("input[name=\"tax_class_id\"]").val(a);var b=Math.floor(1e5*Math.random()),c=Math.floor(1e5*Math.random());$(".add-new-data").find("input[name=\"compound\"]").attr("id","switch-"+b).closest(".switch").find("label").attr("for","switch-"+b),$(".add-new-data").find("input[name=\"shipping\"]").attr("id","switch-"+c).closest(".switch").find("label").attr("for","switch-"+c);var d=$(".add-new-data").html(),e=$(this).closest("tr");$(e).closest("tbody").find("td:contains(\"No tax rate found\")").remove(),e.html(d),e.closest("table").append(`
        <tr>
            <td colspan="10" class="pt-3">
                <button type="button" data-id="${a}" class="btn custom-btn-submit btn-sm add-btn">${jsLang("Add New")}</button>
                <button type="submit" data-id="${a}" class="btn custom-btn-submit btn-sm update-btn">${jsLang("Save")}</button>
            </td>
        </tr>
    `)}),$(document).on("click",".update-btn",function(){var a=$(this).closest(".parent");blockElement(a);var b=SITE_URL+"/tax-rate/update",c=this;$(this).text(jsLang("Saving")).append(`<div class="spinner-border spinner-border-sm ml-2" role="status"></div>`);var d=[];$(this).closest(".tax-rate-data").find("tr").each((a,b)=>{if(10<$(b).find("input, select").length){var c={},e=0;$(b).find("input, select").each((a,b)=>{c[$(b).attr("name")]="*"==$(b).val().trim()?"":$(b).val(),""!=$(b).val().trim()&&"*"!=$(b).val().trim()&&("country"==$(b).attr("name")?e+=8:"state"==$(b).attr("name")?e+=4:"city"==$(b).attr("name")?e+=2:"postcode"==$(b).attr("name")&&(e+=1)),c.sort_by=e}),c.country=c.country.toLowerCase(),d.push(c)}}),0==d.length&&d.push({tax_class_id:$(c).attr("data-id")}),$.ajax({url:b,type:"POST",data:{_token:token,data:d},success:function(b){$("#topNav-v-pills-tabContent").html(b),$("a[href=\"#v-pills-general\"]").tab("show"),$(`a[href="#${$(a).attr("id")}"]`).tab("show"),triggerNotification(jsLang("Tax rate has been successfully saved"))},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(){unblockEverything()}})}),$(document).on("click",".action-btn",function(){changeSetting(this),$(this).closest("tr").remove()});var taxClassStoreCount=0;$(document).on("submit","#addTaxClass",function(a){if(a.preventDefault(),taxClassStoreCount++,1<taxClassStoreCount)return!1;var b=this,c=$(".tax-setting-parent");$.ajax({url:$(b).attr("action"),type:"POST",data:$(b).serialize(),dataType:"JSON",success:function(a){if("success"==a.status){var d=a.name,e=a.slug,f=a.id;successNotification(c,a.message);var g=`
                <div class="toast rounded-0 shadow-none text-dark border bg-light mb-2 tax-class w-100">
                    <div class="d-flex justify-content-between align-items-center p-2">
                        <div class="toast-body pe-3 font-bold ps-0 py-0 mr-4 font-weight-bold tax-class-name">
                            ${d+" "+jsLang("Rates")}
                        </div>
                        <div>
                            <a href="javascript:void(0)"
                                data-bs-toggle="modal"
                                data-bs-target="#edit-tax-class"
                                data-id="${f}"
                                data-name="${d}"
                                data-slug="${e}"
                                class="text-dark edit-tax-class-btn">
                                <span title="${jsLang("Edit")}" class="fa fa-edit"> &nbsp;</span>
                            </a>
                            <form method="post" action="tax/delete/${f}" id="delete-tax-${f}" accept-charset="UTF-8" class="display_inline delete_tax_class">
                                <input type="hidden" name="_token" value="${token}">
                                <span class="text-dark cursor_pointer delete-button" data-bs-toggle="modal" data-label="Delete" data-delete="tax" data-bs-target="#confirmDelete"
                                    data-id="${f}" title="${jsLang("Delete Tax")}" data-title="${jsLang("Delete Tax")}" data-message="${jsLang("Are you sure to delete this?")}">
                                    <i class="fa fa-trash"></i>
                                </span>
                            </form>
                        </div>

                    </div>
                </div>
                `;$("div.add-new-class").before(g),$(".nav-pills").append(`
                    <li><a class="nav-link text-left tab-name" id="v-pills-${e}-tab" data-bs-toggle="pill" href="#v-pills-${e}" role="tab" aria-controls="v-pills-standard" aria-selected="true" data-id ="${d+" "+jsLang("Rates")}">${d+" "+jsLang("Rates")}</a></li>
                `),$(".tax-content").append(`
                <div class="tab-pane fade parent mt-25 tax-rate-data" id="v-pills-${e}" role="tabpanel" aria-labelledby="v-pills-${e}-tab">
                    <div class="noti-alert pad no-print warningMessage mt-2 px-2">
                        <div class="alert warning-message abc">
                            <strong id="warning-msg" class="msg"></strong>
                        </div>
                    </div>
                    <div class="row px-4">
                        <div class="col-sm-12 p-0">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">${jsLang("Name")}</th>
                                            <th scope="col">${jsLang("Country")}</th>
                                            <th scope="col">${jsLang("State")}</th>
                                            <th scope="col">${jsLang("City")}</th>
                                            <th scope="col">${jsLang("Post code")}</th>
                                            <th width="100" scope="col">${jsLang("Rate")} %</th>
                                            <th width="100" scope="col">${jsLang("Priority")}</th>
                                            <th width="5" scope="col">${jsLang("Compound")}</th>
                                            <th width="5" scope="col">${jsLang("Shipping")}</th>
                                            <th width="5" scope="col">${jsLang("Action")}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center" colspan="10">${jsLang("No tax rate found.")}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="10" class="pt-3">
                                                <button type="button" data-id="${f}" class="btn custom-btn-submit btn-sm add-btn">${jsLang("Add New")}</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                `),$("#shipping_tax_class").append(`
                    <option value="${e}">${d}</option>
                `),$(b).trigger("reset")}else failNotification(c,a.message);$(b).closest(".tax-class").remove()},error:function(a){errorNotification(c,a)},complete:function(){$(".modal").modal("hide"),$(".spinner-border").remove(),$(".tax-class-submit").text(jsLang("Save")),taxClassStoreCount=0}}),timeoutNotification(c)}),$(document).on("click",".edit-tax-class-btn",function(){$("#edit-tax-class").find("input[name=\"id\"]").val($(this).attr("data-id")),$("#edit-tax-class").find("input[name=\"name\"]").val($(this).attr("data-name")),$("#edit-tax-class").find("input[name=\"slug\"]").val($(this).attr("data-slug"))});var editTaxClassBtn="";$(document).on("click",".edit-tax-class-btn",function(){editTaxClassBtn=this});var taxClassUpdateCount=0;$(document).on("submit","#edit-tax-form",function(a){if(a.preventDefault(),taxClassUpdateCount++,1<taxClassUpdateCount)return!1;var b=this,c=$(".tax-setting-parent");$.ajax({url:$(b).attr("action"),type:"POST",data:$(b).serialize(),dataType:"JSON",success:function(a){if("success"==a.status){var b=a.name,d=a.slug;successNotification(c,a.message);var e=b+" "+jsLang("Rates");$(editTaxClassBtn).closest(".tax-class").find(".tax-class-name").text(e);var f=$(`#v-pills-${$(editTaxClassBtn).attr("data-slug")}-tab`);$(".nav-pills").append(`
                    <li><a class="nav-link text-left tab-name" id="v-pills-${d}-tab" data-bs-toggle="pill" href="#v-pills-${d}" role="tab" aria-controls="v-pills-standard" aria-selected="true" data-id ="${b+" "+jsLang("Rates")}">${b+" "+jsLang("Rates")}</a></li>
                `),$("#shipping_tax_class").find(`option[value="${$(editTaxClassBtn).attr("data-slug")}"]`).attr("value",d).text(b),f.remove();var g=$(`#v-pills-${$(editTaxClassBtn).attr("data-slug")}`);g.attr("aria-labelledby",`v-pills-${d}-tab`),g.attr("id",`v-pills-${d}`),$(editTaxClassBtn).attr("data-name",b).attr("data-slug",d)}else failNotification(c,a.message)},error:function(a){errorNotification(c,a)},complete:function(){$(".modal").modal("hide"),$(".spinner-border").remove(),$(".tax-class-submit").text(jsLang("Save")),taxClassUpdateCount=0}}),timeoutNotification(c)}),$(document).on("click","#confirmDeleteSubmitBtn",function(){$(this).text(jsLang("Deleting")).append(`<div class="spinner-border spinner-border-sm ml-2" role="status"></div>`)});var taxDeleteCount=0;$(document).on("submit",".delete_tax_class",function(a){if(a.preventDefault(),taxDeleteCount++,!(1<taxDeleteCount)){var b=$(this).closest(".parent"),c=this;$.ajax({url:$(c).attr("action"),type:"POST",data:{_token:token},dataType:"JSON",success:function(a){if("success"==a.status){successNotification(b,a.message),$(b).closest("tr").remove();var d=$(c).closest("div").find("a").attr("data-slug");$(`#v-pills-${d}-tab`).remove(),$(`#v-pills-${d}`).remove(),$("#shipping_tax_class").find(`option[value="${d}"]`).remove()}else failNotification(b,a.message);$(c).closest(".tax-class").remove()},error:function(a){errorNotification(b,a)},complete:function(){$(".modal").modal("hide"),taxDeleteCount=0}}),timeoutNotification(b)}});var taxUpdateCount=0;$(document).on("click",".tax-setting-btn",function(){if(taxUpdateCount++,!(1<taxUpdateCount)){var a=$(this).closest("tr"),b=$(this).closest(".parent");$(this).text(jsLang("Saving")).append(`<div class="spinner-border spinner-border-sm ml-2" role="status"></div>`).addClass("disabled-btn"),$.ajax({url:SITE_URL+"/tax-setting/update",type:"POST",data:$(".tax-setting").find("input, select").serialize(),dataType:"JSON",success:function(c){"success"==c.status?(successNotification(b,c.message),a.remove()):failNotification(b,c.message)},error:function(a){errorNotification(b,a)},complete:function(){$(".tax-class-submit").text(jsLang("Save")).removeClass("disabled-btn").find(".spinner-border").remove(),taxUpdateCount=0}}),timeoutNotification(b)}});var currentTab="v-pills-general-tab",activeHelp=!1;$(document).on("click",".tab-name",function(){"v-pills-help-tab"!=$(this).attr("id")&&(currentTab=$(this).attr("id"),activeHelp=!1),$(".tab-help").removeClass("active"),$(".tab-pane").removeClass("show active"),$(`.tab-pane[aria-labelledby="${$(this).attr("id")}"`).addClass("show active"),$(".tab-pane[aria-labelledby=\"home-tab\"").addClass("show active"),$(".tab-help").css("color","#6c757d"),"Options"==$(this).text()?$(".tab-help").hide():$(".tab-help").show()}),$(document).on("click",".tab-name.tab-help",function(){return activeHelp?($("#"+currentTab).trigger("click"),!1):void($(".tab-name").removeClass("active"),$(this).addClass("active"),$(this).css("color","#fcca19"),activeHelp=!0)}),$(".main-body .page-wrapper").find("#tax-container").length&&$(".tab-pane[aria-labelledby=\"v-pills-general-tab\"").addClass("show active");
