'use strict';if($(".select2").select2(),$(".main-body .page-wrapper").find("#add-ticket-container").length){function a(){$("#assign_name").val($("#customer_id option:selected").attr("data-name")),$("#assign_email").val($("#customer_id option:selected").attr("data-email"))}var theEditor;$(document).on("change","#customer_id",function(){a()}),""!=projectId&&$("#project_id, #customer_id").prop("disabled",!0),$("body").on("click",".delete_file_field",function(){$(this).parents(".control-group").remove()}),validateCKEditor("#ticket_messages","#ticket_messages-error"),$("#add_ticket_form").validate({ignore:[],rules:{subject:{required:!0},project_id:{required:!0},assign_id:{required:!0},department_id:{required:!0},priority_id:{required:!0},customer_id:{required:function(){return"yes"!=$("#flag").val()}},message:{CKEditorRequired:!0}}}),$("select").on("change",function(){""!=$(this).val()&&$(this).valid(),$("#project_id").on("change",function(){var a=$("#project_id").val();$.ajax({method:"get",url:SITE_URL+"/ticket/check-inhouse-project",data:{id:a}}).done(function(a){"yes"==a?($(".select-customer-div, .customer-info-div").hide(),$("#flag").val("yes")):($(".select-customer-div, .customer-info-div").show(),$("#flag").val("no"))})})}),deleteAttachment(SITE_URL+"/file/remove?type=ticket_reply"),uploadAttachment(SITE_URL+"/file/upload?type=ticket_reply","#customer_id"),$("#add_ticket_btn").on("click",function(){!0==$("#add_ticket_form").valid()&&($(".spinner").show().css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled",!0),$("#add_ticket_form").trigger("submit"))})}if($(".main-body .page-wrapper").find("#edit-ticket-container").length&&($(function(){$("#assign_name").val($("#customer_id option:selected").attr("data-name")),$("#assign_email").val($("#customer_id option:selected").attr("data-email"))}),$(document).on("change","#customer_id",function(){$("#assign_name").val($("option:selected",this).attr("data-name")),$("#assign_email").val($("option:selected",this).attr("data-email"))}),$("body").on("click",".delete_file_field",function(){$(this).parents(".control-group").remove()}),$("#edit-ticket-form").validate({ignore:[],rules:{subject:{required:!0},project_id:{required:!0},assign_id:{required:!0},department_id:{required:!0},priority_id:{required:!0},customer_id:{required:!0}}}),$("select").on("change",function(){""!=$(this).val()&&$(this).valid()})),$(".main-body .page-wrapper").find("#ticket-list-container").length&&($("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(document).on("click","#csv",function(a){a.preventDefault(),window.location=SITE_URL+"/ticket_csv?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+$("#project").val()+"&department_id="+$("#department_id").val()+"&status="+$("#status").val()+"&assignee="+$("#assignee").val()}),$(document).on("click","#pdf",function(a){a.preventDefault(),window.location=SITE_URL+"/ticket_pdf?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+$("#project").val()+"&department_id="+$("#department_id").val()+"&status="+$("#status").val()+"&assignee="+$("#assignee").val()}),$("#theModal").on("show.bs.modal",function(a){var b=$(a.relatedTarget),c=$(this);$("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==b.data("label")?(c.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",b.data("id")).text(jsLang("Delete")).show(),c.find("#theModalLabel").text(b.data("title")),c.find(".modal-body").text(b.data("message"))):(c.find(".modal-body").html("<div class=\"spinner\"><div class=\"bounce1\"></div><div class=\"bounce2\"></div><div class=\"bounce3\"></div></div>"),c.find(".modal-body").load(b.data("remote")))}),$("#theModalSubmitBtn").on("click",function(){$("#delete-item-"+$(this).data("task")).trigger("submit")}),$(window).on("load",function(){576>$(window).width()&&$("#headerDiv").addClass("pb-3")}),$("body").tooltip({selector:"[data-toggle=\"tooltip\"]"}),$(document).on("click",".ticket_status_change",function(){var a=$(this).attr("data-id"),b=$(this).attr("ticket_id"),c=$(this).attr("data-value");ticketStatusChange(SITE_URL+"/ticket/change-status",a,b,c)})),$(".main-body .page-wrapper").find("#reply-ticket-container1").length){var stack=[];hideNoDiv(),$(document).on("click",".status_change",function(){var a=$(this).attr("data-id"),b=$(this).attr("ticket_id");$.ajax({url:SITE_URL+"/ticket/change-status",method:"POST",data:{status_id:a,ticketId:b,_token:token},dataType:"json",success:function(a){if(1==a.status){$("#status_label").html(a.newName),$("#status_label").css("color",a.newStatusColor),$("#ticket-status").html(a.newName),$("#ticket-status").removeClass("text-white").css("color",a.newStatusColor);var c=a.newName;$.ajax({url:SITE_URL+"/ticket/get-status",method:"POSt",data:{statusName:c,ticketId:b,_token:token},dataType:"json",success:function(a){1==a.status?($("#removeLi ul").empty(),$("#removeLi ul").append(a.output)):swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}else swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}),validateCKEditor("#ticket_messages","#ticket_messages-error"),$("#reply_form").validate({ignore:[],rules:{message:{CKEditorRequired:!0}},submitHandler:function(){return $(".spinner").show().css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$("#btnSubmit").attr("disabled",!0),!0}}),$(function(){var a=$("#customer_id option:selected").attr("data-name"),b=$("#customer_id option:selected").attr("data-email");$("#assign_name").val(a)});var editorValue;ClassicEditor.create(document.querySelector("#reply-modal")).then(a=>{editorValue=a,theEditor=intialData=a.getData(),a.model.document.on("change",()=>{let b=intialData=a.getData();return b=b.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=b,0==b.length?($("#reply-modal-error").show().html(jsLang("This field is required.")),!1):void $("#reply-modal-error").hide().html("")})}).catch(()=>{}),$(".edit-btn").on("click",function(){editorValue.setData($(this).attr("data-message"));$(".ck-content").children("p.first").val();$("#reply_id").val($(this).attr("data-id")),$("#update_type").val($(this).attr("data-type"))}),$("#replyModal").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}});var editorNote;ClassicEditor.create(document.querySelector("#txtAreaNote")).then(a=>{editorNote=a,theEditor=intialData=a.getData(),a.model.document.on("change",()=>{let b=intialData=a.getData();return b=b.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=b,0==b.length?($("#txtAreaNote-error").show().html(jsLang("This field is required.")),!1):void $("#txtAreaNote-error").hide().html("")})}).catch(()=>{}),$("#noteForm").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),$("#modal-note").on("show.bs.modal",function(){editorNote.setData($("#txtAreaNote").attr("data-message")),$("#txtAreaNote-error").hide()}),$(document).on("change","#assignee",function(){var a=$("#assignee").val()?$("#assignee").val():null,b=$("#customer_id").val(),c=SITE_URL+"/admin/ticket/change-assignee";$.ajax({url:c,method:"POST",data:{user_id:a,customer_id:b,ticket_id:ticket_id,_token:token},dataType:"json",beforeSend:function(){swal({title:jsLang("Loading..."),text:$("#assignee option:selected").text()+", "+jsLang("assigning to this ticket"),buttons:!1})},success:function(b){"1"==b.status?($("#assignee").val(a).trigger("change"),swal($("#assignee option:selected").text()+jsLang(" successfully assigned"),{icon:"success",buttons:[!1,jsLang("Ok")]})):"2"==b.status&&($("#assignee").val(a).trigger("change"),swal(jsLang(" please check your email configuration"),{icon:"error",buttons:[!1,jsLang("Ok")]}))}})}),$("body").on("click",".delete_file_field",function(){$(this).parents(".control-group").remove()}),deleteAttachment(SITE_URL+"/file/remove"),uploadAttachment(SITE_URL+"/file/upload?type=ticket_reply","#customer_id"),$(document).on("click",".ticket_priority_change",function(){var a=$(this).attr("data-id"),b=$(this).attr("ticket_id"),c=$(this).attr("data-value");ticketPriorityChange(SITE_URL+"/admin/ticket/priority-status",a,b,c)}),$("#reply_form").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),$(document).on("click",".project-name-change",function(){var a=$(this).attr("data-value"),b=SITE_URL+"/ticket/change-project",c=SITE_URL+"/project/details/"+$(this).attr("data-id");$.ajax({url:b,method:"post",data:{projectId:$(this).attr("data-id"),ticketId:$(this).attr("ticket_id"),_token:token},dataType:"json",success:function(b){if(1==b.status)$("#removeLiProject ul").empty(),$("#removeLiProject ul").append(b.output),$(".project-name").html(a),$(".project-url").html(a),$(".project-url").attr("href",c);else{$(".noti-alert").append("<div class=\"alert alert-danger\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">\xD7</button><strong>Something went wrong, please try again.</strong></div>"),$("#notifications").css("display","block")}}})})}