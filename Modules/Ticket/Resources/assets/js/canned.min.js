"use strict";$(document).ready(function(){function a(a=null,b=null,c=null,d=null,e=null){let f=$(d).val();$.ajax({url:c,dataType:"json",type:"POST",data:{_token:token,search:f},success:function(a){if(1==a.status_no){var a=a.canned;b($.map(a,function(a){return{id:a.id,value:a.filter_data,fullValue:a.data}}))}else $(".ui-menu-item").remove(),$(e).css("top",$(d).position().top+35),$(e).css("left",$(d).position().left),$(e).css("width",$(d).width()),$(e).css("display","block")}})}hideNoDiv(),$("#cannedLink_search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(b,c){a(b,c,SITE_URL+"/canned/search/link","#cannedLink_search","#no_div_link")},select:function(a,b){var c=b.item;if(c.id){let a;return a=13<c.value.length?c.value+c.fullValue:c.fullValue,$(".txtAreaCanned").summernote("pasteHTML",a),this.value="",!1}},minLength:1,autoFocus:!0}),$("#cannedMsg_search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(b,c){a(b,c,SITE_URL+"/canned/search/message","#cannedMsg_search","#no_div_msg")},select:function(a,b){var c=b.item;if(c.id){let a;return a=13<c.value.length?c.value+c.fullValue:c.fullValue,$(".txtAreaCanned").summernote("pasteHTML",a),this.value="",!1}},minLength:1,autoFocus:!0}),$(document).on("blur","#cannedMsg_search, #cannedLink_search",function(){"cannedMsg_search"==$(this).attr("id")?$("#no_div_msg").hide():$("#no_div_link").hide()})});function clickOnSave(a=null,b=null,c=[]){$.ajax({type:b,url:SITE_URL+a,data:{_token:token,array_value:c},success:function(a){1==a.status?swal(jsLang("Successfully Saved"),{icon:"success",buttons:[!1,jsLang("Ok")]}):typeof(a.error!=null)?swal(a.error,{icon:"error",buttons:[!1,jsLang("Ok")]}):swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}function hideNoDiv(){$("#no_div_msg").hide(),$("#no_div_link").hide()}function dataTable(a,b){$(a).DataTable({columnDefs:[{targets:b,orderable:!1}],language:{url:app_locale_url},pageLength:row_per_page})}function confirmDelete(a,b,c,d){$(a).on("show.bs.modal",function(a){var e=$(a.relatedTarget),f=$(this);$(b).attr("data-task","").removeClass("delete-task-btn"),"Delete"==e.data("label")&&(f.find(b).addClass("delete-task-btn").attr("data-task",e.data("id")).text(jsLang("Delete")).show(),f.find(c).text(e.data("title")),f.find(".modal-body").text(e.data("message"))),$("#confirmDeleteSubmitBtn").on("click",function(){$(d+$(this).data("task")).trigger("submit")})})}var jsonData=[];$("#cannedForm").on("submit",function(a){a.preventDefault();let b=$("#title").val();$(".txtAreaCanned").summernote("codeview.isActivated")&&$(".txtAreaCanned").summernote("codeview.deactivate"),jsonData={title:b,message:$(".txtAreaCanned:last").summernote("code")},clickOnSave("/canned/messages/save","POST",jsonData),$("#modal-canned").modal("hide"),document.getElementById("cannedForm").reset(),"undefined"!=typeof $("#type").val()&&"list"==$("#type").val()&&setTimeout(location.reload.bind(location),1500)});function isUrlValid(a){var b=a.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g);return null!=b}function customLinkValidation(){let a,b,c,d,e,f,g,h,j=0,k=$("input[name='row_identify[]']").map(function(){return $(this).val()}).get();for(let l=0;l<k.length;l++){a=0,f=0,g=0,h=0;let i=0;$.each($("#link-title-"+k[l]),function(){$(this).val()&&(150>$(this).val().length&&(f=1),i=1),$("#link-"+k[l]).val()&&(255>$("#link-"+k[l]).val().length&&(g=1),isUrlValid($("#link-"+k[l]).val())&&(h=1),a=1)}),0==a&&0==g&&0==h?($("#link-"+k[l]).addClass("err1"),$("#link-text-"+k[l]).text(jsLang("This field is required.")),b=1):1==a&&0==g&&0==h?($("#link-"+k[l]).addClass("err1"),$("#link-text-"+k[l]).text(jsLang("Please provide at most 255 characters.")),d=1):1==a&&1==g&&0==h?($("#link-"+k[l]).addClass("err1"),$("#link-text-"+k[l]).text(jsLang("Please enter a valid link.")),e=1):($("#link-"+k[l]).removeClass("err1"),$("#link-text-"+k[l]).text("")),0==i&&0==f?($("#link-title-"+k[l]).addClass("err1"),$("#link-title-text-"+k[l]).text(jsLang("This field is required.")),j=1):1==i&&0==f?($("#link-title-"+k[l]).addClass("err1"),$("#link-title-text-"+k[l]).text(jsLang("Please provide at most 150 characters.")),c=1):($("#link-title-"+k[l]).removeClass("err1"),$("#link-title-text-"+k[l]).text(""))}return 1!=b&&1!=j&&1!=c&&1!=d&&1!=e}if($(document).on("click",".deleteCustomLink",function(a){a.preventDefault();var b=$(this).attr("data-row-id");$("#rowid-"+b).remove()}),$("#linkForm").on("submit",function(a){a.preventDefault();let b,c,d=0,e=0;"undefined"!=typeof $("#type").val()&&"reply"==$("#type").val()?!0==customLinkValidation()&&(b=$("input[name='link[]']").map(function(){return $(this).val()}).get(),c=$("input[name='title[]']").map(function(){return $(this).val()}).get(),d=1,jsonData={title:c,editorValue:b}):!0==$("#linkForm").valid()&&(b=$("#link").val(),c=$("#title").val(),d=1,e=1,jsonData={title:c,editorValue:b,status:"link_list"}),1==d&&(clickOnSave("/canned/links/save","POST",jsonData),$("#modal-link").modal("hide"),1==e&&setTimeout(location.reload.bind(location),1500))}),$(".main-body .page-wrapper").find("#canned-message-settings-container").length&&($(document).on("click",".edit_canned_message",function(){var a=$(this).attr("id");$.ajax({url:SITE_URL+"/canned/messages/edit",data:{id:a,_token:token},type:"POST",dataType:"JSON",success:function(a){$("#edit_title").val(a.title),$("#canned_id").val(a.id),cannedEditorValueEdit.setData(a.message)}})}),$("#editMessageForm").validate({ignore:[],rules:{canned_message:{CKEditorRequired:!0},title:{required:!0,maxlength:150}}}),$("#editMessageForm").on("submit",function(a){if(a.preventDefault(),!0==$("#editMessageForm").valid()){let a=$("#edit_title").val(),b=$("#canned_id").val();jsonData={id:b,title:a,editorValue:cannedEditorValueEdit.getData()},clickOnSave("/canned/messages/update","POST",jsonData),$("#edit-canned-message").modal("hide"),setTimeout(location.reload.bind(location),1500)}}),$("#modal-canned").on("hidden.bs.modal",function(){$(this).find("input[name=title]").val(""),$(this).find("textarea[name=canned_message]").text(""),$("#cannedForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error"),$("#txtAreaCanned").code("")}),$("#edit-canned-message").on("show.bs.modal",function(){$("#editMessageForm").validate().resetForm()}),$("#edit-lead-source").on("hidden.bs.modal",function(){$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error")}),dataTable("#dataTableBuilder",3),confirmDelete("#confirmDelete","#confirmDeleteSubmitBtn","#confirmDeleteLabel","#delete-canned-")),$(".main-body .page-wrapper").find("#canned-links-settings-container").length&&($(document).on("click",".edit_canned_link",function(){var a=$(this).attr("id");$.ajax({url:SITE_URL+"/canned/links/edit",data:{id:a,_token:token},type:"POST",dataType:"JSON",success:function(a){$("#edit_link").val(a.link),$("#edit_title").val(a.title),$("#link_id").val(a.id)}})}),$("#editLinkForm").validate({ignore:[],rules:{link:{required:!0,regexLink:!0,maxlength:255},title:{required:!0,maxlength:150}}}),$("#editLinkForm").on("submit",function(a){if(a.preventDefault(),!0==$("#editLinkForm").valid()){let a=$("#edit_title").val(),b=$("#edit_link").val(),c=$("#link_id").val();jsonData={id:c,title:a,editorValue:b,status:"link_list"},clickOnSave("/canned/links/update","POST",jsonData),$("#edit-canned-link").modal("hide"),setTimeout(location.reload.bind(location),1500)}}),$("#modal-link").on("hidden.bs.modal",function(){$(this).find("input[name=title]").val(""),$(this).find("input[name=link]").val(""),$("#linkForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("input[name=link]").removeClass("error")}),$("#edit-canned-link").on("show.bs.modal",function(){$("#editLinkForm").validate().resetForm()}),$("#edit-canned-link").on("hidden.bs.modal",function(){$(this).find("input[name=title]").removeClass("error"),$(this).find("input[name=link]").removeClass("error")}),dataTable("#dataTableBuilder",3),confirmDelete("#confirmDelete","#confirmDeleteSubmitBtn","#confirmDeleteLabel","#delete-canned-")),$(".main-body .page-wrapper").find("#reply-ticket-container").length||$(".main-body .page-wrapper").find("#cus-panel-ticket-reply-container").length){function a(a){let b=[];let c=0;return a.replace(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g,function(a){b[c++]=a}),b}$(".main-body .page-wrapper").find("#reply-ticket-container").length&&($(".canned-btn").on("click",function(){$(".ck-content").children("p.first").val()}),$(document).on("click","#canned_msg",function(a){a.preventDefault()}),$(document).on("click","#canned_link",function(b){b.preventDefault();let c=a($(".txtAreaCanned").summernote("code"));if(0<c.length){jsonData={editorValue:c};let a="",b=1;for(let d=0;d<c.length;++d)a+=`
                          <div class="row customLinkDiv" id="rowid-${b}">
                             <div class="col-md-5 col-sm-5 padding-bottom">
                                <label class="col-sm-2 control-label require">${jsLang("Title")}</label>
                                <input type="text" data-rel="${b}" data-text="link-title-text" name="title[]" class="form-control" id="link-title-${b}">
                                <span id="link-title-text-${b}" class="validationMsg"></span>
                             </div>
                             <div class="col-md-6 col-sm-6">
                                 <label class="col-sm-2 control-label require">${jsLang("Link")}</label>
                                <input type="text" data-rel="${b}" data-text="link-text" name="link[]" value="${c[d]}" class="form-control" id="link-${b}">
                                <span id="link-text-${b}" class="validationMsg"></span>
                             </div>
                             <input type="hidden" name="row_identify[]" value="${b}">
                             <div class="col-md-1 co-sm-1">
                                <label>${jsLang("Action")}</label>
                                <button type="button" data-row-id="${b}" class="btn btn-xs btn-danger m-t-5 deleteCustomLink"><i class="fa fa-trash"></i></button>
                             </div>
                           </div>`,b++;$("#custom_link").empty(),$("#custom_link").append(a),$("#modal-link").modal("show")}else swal(jsLang("Does not find any link!"),{icon:"error",buttons:[!1,jsLang("Ok")]})})),$("#modal-canned").on("show.bs.modal",function(a){$("#txtAreaCanned").summernote({codeviewFilter:!0,codeviewFilterRegex:summernote_regex}),$(a.relatedTarget).attr("data-id")?$("#txtAreaCanned").summernote("code",$(a.relatedTarget).attr("data-message")):$("#txtAreaCanned").summernote("code",$(".txtAreaCanned").summernote("code").replace(summernote_regex,""))})}
