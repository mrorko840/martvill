"use strict";$(".main-body .page-wrapper").find("#order-list-container, #vendor-order-list-container").length&&($("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(document).on("click",".applyBtn, .ranges ul li:nth-child(1), .ranges ul li:nth-child(2), .ranges ul li:nth-child(3), .ranges ul li:nth-child(4), .ranges ul li:nth-child(5), .ranges ul li:nth-child(6), .ranges ul li:nth-child(7)",(function(event){let startFrom,endto;event.preventDefault();var newOptions={startFrom:$("#startfrom").val()},newOptionsTwo={endto:$("#endto").val()};let startDate=$("#start_date"),end_date=$("#end_date");startDate.empty(),end_date.empty(),$.each(newOptions,(function(key,value){startDate.append($("<option></option>").attr("value",value).text(key))})),$.each(newOptionsTwo,(function(key,value){end_date.append($("<option></option>").attr("value",value).text(key))})),$("#start_date option:first").attr("selected","selected"),$("#end_date option:first").attr("selected","selected"),$("#start_date").trigger("change")}))),$(".main-body .page-wrapper").find("#order-list-container").length&&$(document).on("click","#csv, #pdf",(function(event){event.preventDefault(),window.location=SITE_URL+"/orders/"+this.id})),$(".main-body .page-wrapper").find("#vendor-order-list-container").length&&$(document).on("click","#csv, #pdf",(function(event){event.preventDefault(),window.location=SITE_URL+"/orders/"+this.id}));const unblockEverything=()=>{$(".blockUI").each((function(){$(this).parent().unblock()}))},blockElement=(element,_data={})=>{let options=Object.assign({},{message:'<div class="spinner-border text-warning" role="status"><span class="sr-only">Loading...</span></div>',css:{backgroundColor:"transparent",border:"none"}},_data);element.block(options)},finished=()=>{unblockEverything(),$("#update-order").text(jsLang("Update")),orderUpdate=0},triggerNotification=msg=>{$(".notification-msg-bar").find(".notification-msg").html(msg),$(".notification-msg-bar").removeClass("smoothly-hide"),setTimeout(()=>{$(".notification-msg-bar").addClass("smoothly-hide"),$(".notification-msg-bar").find(".notification-msg").html("")},1500)};function addClassDelivery(){$(".status").each((function(){$(this).hasClass("delivery")||($(this).addClass("delivery"),$(this).prop("disabled",!0))}))}function checkAllStatus(){$(".status").each((function(){if(!$(this).hasClass("delivery"))return!1})),$("#status").val(finalOrderStatus),$("#status").prop("disabled",!0)}function assignOldStatus(){$(".status").each((function(){oldDetailStatus[$(this).attr("data-id")]=$(this).val()}))}$(document).on("change",".status.order-status",(function(){changeStatus[$(this).attr("data-id")]=$(this).val()}));var oldDetailStatus={},changeStatus={};if(assignOldStatus(),$(".main-body .page-wrapper").find("#invoice-view-container").length){$("#updateNote").on("click",(function(){blockElement($(this).closest(".order-notes-container")),$.ajax({url:orderUrl,type:"POST",data:{_token:token,data:{order_id:orderId,note:$("#order_note").val(),type:"note"}},success:function(data){1==data.status?(triggerNotification(data.message),$(".order-notes-container .notes").prepend(`\n                        <div class="order-notes mb-2">\n                            <span>${data.note}</span>\n                        </div>\n                        <div class="date-delete-container">\n                            <span class="date">${data.date}</span>\n                        </div>\n                    `),$("#order_note").val("")):triggerNotification(data.error)},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(data){unblockEverything()}})}));var deliveryDate=null;$("#deliveryDate").on("change",(function(){deliveryDate=$(this).val()}));var oldOrderStatusId=$("#status").val();function updateMainStatus(){let orderStatusId=$("#status").val(),paymentStatus;if("Unpaid"==$("#payment_status").val()&&orderStatusId==finalOrderStatus)return $(`#status option[value="${oldOrderStatusId}"]`).prop("selected",!0),$("#status").siblings(".select2-container").find(".select2-selection__rendered").text($(`#status option[value="${oldOrderStatusId}"]`).text()),triggerNotification(jsLang("Payment status is unpaid.")),finished(),!1;$.ajax({url:SITE_URL+"/orders/change-status",type:"POST",data:{_token:token,data:{status_id:$("#status").val(),order_id:orderId}},success:function(data){1==data.status?(triggerNotification(data.message),oldOrderStatusId=orderStatusId,$(".status").each((function(){$(this).hasClass("delivery")||null!=changeStatus[$(this).attr("data-id")]&&$("#status").val()!=finalOrderStatus||$(this).val(orderStatusId)}))):triggerNotification(data.error),finalOrderStatus==orderStatusId&&($(this).prop("disabled",!0),addClassDelivery(),checkAllStatus())},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(){updateProductStatus(),finished(),location.reload()}})}function updateProductStatus(){let paymentStatus;if("Unpaid"==$("#payment_status").val())for(const key in changeStatus)changeStatus[key]==finalOrderStatus&&($(`.status[data-id=${key}]`).find(`option[value=${oldDetailStatus[key]}]`).prop("selected",!0),delete changeStatus[key]);Object.keys(changeStatus).length>0&&$.ajax({url:SITE_URL+"/orders/change-status",type:"POST",data:{_token:token,data:{status_ids:changeStatus,order_id:orderId,type:"detail"}},success:function(){$(".status").each((function(){$(this).hasClass("delivery")||finalOrderStatus!=$(this).val()||($(this).addClass("delivery"),$(this).prop("disabled",!0))}))},complete:function(){assignOldStatus(),changeStatus={},location.reload()}})}function updateDeliveryDate(){if(null==deliveryDate)return!1;blockElement($(".order-delivery-sections-body")),$.ajax({url:orderUrl,type:"POST",data:{_token:token,data:{order_id:orderId,deliveryDate:deliveryDate,type:"deliveryDate"}},complete:function(){unblockEverything(),deliveryDate=null}})}var orderUpdate=0;$("#update-order").on("click",(function(){if(++orderUpdate>1)return!1;$(this).text(jsLang("Updating")).append('<div class="spinner-border spinner-border-sm ml-2" role="status">'),blockElement($(".order-details-body")),blockElement($(".order-info-table-container")),blockElement($(".download-permission-container")),updateDeliveryDate();let status=$("#payment_status").val();const downloadData=[];$(".download_data").each((function(i,div){downloadData[i]=$(":input",this).map((function(){return{[$(this).attr("name")]:$(this).val()}})).get()})),$.ajax({url:orderUrl,type:"POST",data:{_token:token,data:{order_id:orderId,payment_status:status,user_id:$("#user_id").val(),order_date:$("#order_date").val(),download_data:JSON.stringify(downloadData),type:"general"}},success:function(data){oldOrderStatusId==$("#status").val()&&(1==data.status?triggerNotification(data.message):triggerNotification(data.error))},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(){oldOrderStatusId==$("#status").val()?(updateProductStatus(),finished()):updateMainStatus(),location.reload()}})}));var orderActionCount=0;$(document).on("click","#order_action_btn",(function(e){let actionVal=$("#orderAction").val();if(!actionVal||++orderActionCount>1)return!1;$(this).html('<div class="order-action-loader spinner-border spinner-border-sm">');let data={order_id:orderId,action_val:actionVal,type:"orderAction"};$.ajax({type:"POST",url:orderUrl,data:{_token:token,data:data},success:function(data){1==data.status?triggerNotification(data.message):(data.error,triggerNotification(data.error))},complete:function(){$("#order_action_btn").html('<i class="feather icon-chevron-right fa-2x"></i>'),orderActionCount=0}})})),$(".select-user").select2({ajax:{url:SITE_URL+"/find-users-with-ajax",dataType:"json",delay:250,data:function(params){return{q:params.term,page:params.page}},processResults:function(data,params){let results;return{results:data.data}},cache:!0},placeholder:jsLang("Search for users by name."),minimumInputLength:3})}if(($(".main-body .page-wrapper").find("#invoice-view-container").length||$(".main-body .page-wrapper").find("#vendor-order-view-container").length)&&($(document).on("click",".download_copy_link",(function(e){var copyText=$(this).attr("data-link");navigator.clipboard.writeText(copyText),triggerNotification(jsLang("link copied"))})),$(document).on("click",".revoke_access",(function(e){let file_id=$(this).attr("data-id"),html=$(this),txtHtml=$(this).text();$(this).text(jsLang("Updating")).append('<div class="spinner-border spinner-border-sm ml-2" role="status">'),blockElement($(".download-permission-container")),$.ajax({url:orderUrl,type:"POST",data:{_token:token,data:{order_id:orderId,file_id:file_id,type:"download"}},success:function(data){1==data.status?triggerNotification(data.message):triggerNotification(data.error)},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(){$("#downloadData-"+file_id).remove(),unblockEverything(),html.text(txtHtml)}})})),$("#search_products").select2({ajax:{url:SITE_URL+"/find-downloadable-products-with-ajax",dataType:"json",delay:250,data:function(params){return{q:params.term,page:params.page}},processResults:function(data,params){let results;return{results:data.data}},cache:!0},placeholder:jsLang("Search for a downloadable product"),minimumInputLength:3}),$(document).on("click","#grant_access",(function(e){let txtHtml=$(this).text(),element=$(this);$(this).text(jsLang("Updating")).append('<div class="spinner-border spinner-border-sm ml-2" role="status">'),blockElement($(".download-permission-container")),$.ajax({url:SITE_URL+"/grant-access-with-ajax",type:"POST",data:{_token:token,product_ids:$('select[name="grant_access[]"]').map((function(){return $(this).val()})).get(),order_id:orderId},dataType:"json",success:function(data){if(1==data.status){let html="";$.each(data.data,(function(i,v){(1==parseInt(v.is_accessible)&&"undefined"!=typeof vendorId&&vendorId==v.vendor_id||1==parseInt(v.is_accessible)&&"admin"==orderView)&&(html+=`\n                                <div class="col-sm-12 download_data" id="downloadData-${v.id}">\n                                    <div class="row px-3">\n                                        <div class="col-md-2 mt-2 mt-md-0">\n                                            <span>${jsLang("Download limit")}</span>\n                                            <div class="d-flex">\n                                                <input type="hidden" name="id" value="${v.id}">\n                                                <input value="${v.download_limit}" name="download_limit" class="form-control inputFieldDesign" type="text">\n                                            </div>\n                                        </div>\n                                        <div class="col-md-2 mt-2 mt-md-0">\n                                            <span>${jsLang("Download expiry")}</span>\n                                            <div class="d-flex">\n                                              <input value="${v.download_expiry}" name="download_expiry" class="form-control inputFieldDesign" type="text">\n                                            </div>\n                                        </div>\n                                        <div class="col-md-3">\n                                            <span>${jsLang("Customer download link")}</span>\n                                            <div class="d-flex">\n                                              <a href="javascript:void(0)" class="download_copy_link btn-default p-1" data-link = "${v.link}">${jsLang("Copy Link")}</a>\n                                            </div>\n                                        </div>\n                                        <input type="hidden" name="link" value="${v.link}">\n                                        <input type="hidden" name="download_times" value="${v.download_times}">\n                                        <input type="hidden" name="is_accessible" value="${v.is_accessible}">\n                                        <input type="hidden" name="vendor_id" value="${v.vendor_id}">\n                                        <input type="hidden" name="name" value="${v.name}">\n                                        <input type="hidden" name="f_name" value="${v.f_name}">\n                                        <div class="col-md-3 mt-2 mt-md-0">\n                                            <span>${jsLang("Access")}</span>\n                                            <div class="d-flex">\n                                                <a href="javascript:void(0)" class="revoke_access btn-default p-2" data-id="${v.id}">${jsLang("Revoke access")}</a>\n                                            </div>\n                                        </div>\n                                        <div class="col-md-2 mt-2 mt-md-0">\n                                            <span>${jsLang("Downloaded")}</span>\n                                            <div class="d-flex">\n                                                ${v.download_times+" "+jsLang("Times")}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                `)})),$("#download_div").html(html)}},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(){unblockEverything(),element.text(txtHtml),$("#search_products").empty()}})}))),$(".main-body .page-wrapper").find("#vendor-order-view-container").length){$("#updateNote").on("click",(function(){blockElement($(this).closest(".order-notes-container")),$.ajax({url:SITE_URL+"/store-note",type:"POST",data:{_token:token,data:{order_id:orderId,note:$("#order_note").val()}},success:function(data){1==data.status?(triggerNotification(data.message),$(".order-notes-container .notes").prepend(`\n                        <div class="order-notes mb-2">\n                            <span>${data.note}</span>\n                        </div>\n                        <div class="date-delete-container">\n                            <span class="date">${data.date}</span>\n                        </div>\n                    `),$("#order_note").val("")):triggerNotification(data.error)},error:function(){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(data){unblockEverything()}})}));var orderActionCount=0;$(document).on("click","#order_action_btn",(function(e){let actionVal=$("#orderAction").val();if(!actionVal||++orderActionCount>1)return!1;$(this).html('<div class="order-action-loader spinner-border spinner-border-sm">');let data={order_id:orderId,action_val:actionVal,type:"orderAction"};$.ajax({type:"POST",url:SITE_URL+"/order/actions",data:{_token:token,data:data},success:function(data){1==data.status?triggerNotification(data.message):(data.error,triggerNotification(data.error))},complete:function(){$("#order_action_btn").html('<i class="feather icon-chevron-right fa-2x"></i>'),orderActionCount=0}})}));var orderUpdate=0;$("#update-order").on("click",(function(){if(++orderUpdate>1)return!1;const downloadData=[];$(".download_data").each((function(i,div){downloadData[i]=$(":input",this).map((function(){return{[$(this).attr("name")]:$(this).val()}})).get()})),$(this).text(jsLang("Updating")).append('<div class="spinner-border spinner-border-sm ml-2" role="status">'),blockElement($(".order-info-table-container")),blockElement($(".download-permission-container"));var unpaidFinalStatus=0;if("Unpaid"==paymentStatus)for(const key in changeStatus)changeStatus[key]==finalOrderStatus&&($(`.status[data-id=${key}]`).find(`option[value=${oldDetailStatus[key]}]`).prop("selected",!0),delete changeStatus[key],++unpaidFinalStatus);if(unpaidFinalStatus>0)return triggerNotification(jsLang("Please pay first in order to reach the final status.")),finished(),!1;$.ajax({url:SITE_URL+"/orders/change-status",type:"POST",data:{_token:token,data:{status_ids:changeStatus,id:orderId,type:"detail",download_data:JSON.stringify(downloadData)}},success:function(data){$(".status").each((function(){$(this).hasClass("delivery")||finalOrderStatus!=$(this).val()||($(this).addClass("delivery"),$(this).prop("disabled",!0))})),triggerNotification(data.message)},complete:function(){assignOldStatus(),changeStatus={},finished(),location.reload()}})}))}